```python
%cd UT03/pro302
```

    [Errno 2] No such file or directory: 'UT03/pro302'
    /home/jovyan/work/UT03/pro302



```python
import pandas as pd
import json
```


```python
df_norte = pd.read_csv("./ventas_norte_V2.csv",sep=";")
df_sur = pd.read_excel("./ventas_sur_v2.xlsx", sheet_name=None)
df_sur = pd.concat(df_sur,ignore_index=True)

with open('ventas_este_v2.json', 'r', encoding='utf-8') as f:
    datos_crudos = json.load(f)


df_este = pd.json_normalize(datos_crudos, sep='_')


columnas_map = {
    'data_id_registro': 'id_transaccion',
    'data_payload_fecha_evento': 'fecha',
    'data_payload_comprador_ubicacion_ciudad': 'ciudad',
    'data_payload_transaccion_detalles_producto_nombre_comercial': 'producto',
    'data_payload_transaccion_cantidad_comprada': 'cantidad',
    'data_payload_transaccion_detalles_producto_precio_lista': 'total_venta',
    'data_payload_transaccion_detalles_producto_impuestos_monto_iva': 'Monto_IVA'
}


df_este = df_este[columnas_map.keys()].rename(columns=columnas_map)

```


```python
df_norte["Total_Factura"] = df_norte["Total_Factura"].replace({'\$': '', ',': ''}, regex=True)
df_norte["Total_Factura"] = pd.to_numeric(df_norte["Total_Factura"])

mapping_norte = {
    "ID_Pedido" : "id_transaccion",
    'Fecha_Transaccion': 'fecha',
    "Total_Factura" : "total_venta",
    'Producto': 'producto',
    "Unidades":"cantidad"
}
df_norte = df_norte.rename(columns=mapping_norte)
df_norte["region"] = "norte"

columnas_finales = ["id_transaccion",'fecha', 'producto', 'cantidad', 'total_venta',"region"]
df_norte = df_norte[columnas_finales]

df_norte
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id_transaccion</th>
      <th>fecha</th>
      <th>producto</th>
      <th>cantidad</th>
      <th>total_venta</th>
      <th>region</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>N-1000</td>
      <td>2023-05-10 03:00:00</td>
      <td>Laptop Gamer</td>
      <td>1</td>
      <td>970.0</td>
      <td>norte</td>
    </tr>
    <tr>
      <th>1</th>
      <td>N-1001</td>
      <td>2023-06-18 09:00:00</td>
      <td>Mouse Ergonómico</td>
      <td>4</td>
      <td>3708.0</td>
      <td>norte</td>
    </tr>
    <tr>
      <th>2</th>
      <td>N-1002</td>
      <td>2023-03-10 05:00:00</td>
      <td>Monitor 4K</td>
      <td>2</td>
      <td>2820.0</td>
      <td>norte</td>
    </tr>
    <tr>
      <th>3</th>
      <td>N-1003</td>
      <td>2023-05-10 03:00:00</td>
      <td>Webcam HD</td>
      <td>2</td>
      <td>2538.0</td>
      <td>norte</td>
    </tr>
    <tr>
      <th>4</th>
      <td>N-1004</td>
      <td>2023-02-25 17:00:00</td>
      <td>Webcam HD</td>
      <td>2</td>
      <td>908.0</td>
      <td>norte</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>145</th>
      <td>N-1145</td>
      <td>2023-04-17 10:00:00</td>
      <td>Teclado Mecánico</td>
      <td>4</td>
      <td>4204.0</td>
      <td>norte</td>
    </tr>
    <tr>
      <th>146</th>
      <td>N-1146</td>
      <td>2023-04-08 00:00:00</td>
      <td>Monitor 4K</td>
      <td>2</td>
      <td>2458.0</td>
      <td>norte</td>
    </tr>
    <tr>
      <th>147</th>
      <td>N-1147</td>
      <td>2023-02-01 22:00:00</td>
      <td>Monitor 4K</td>
      <td>1</td>
      <td>1040.0</td>
      <td>norte</td>
    </tr>
    <tr>
      <th>148</th>
      <td>N-1148</td>
      <td>2023-06-13 03:00:00</td>
      <td>Laptop Gamer</td>
      <td>1</td>
      <td>297.0</td>
      <td>norte</td>
    </tr>
    <tr>
      <th>149</th>
      <td>N-1149</td>
      <td>2023-02-24 01:00:00</td>
      <td>Monitor 4K</td>
      <td>1</td>
      <td>909.0</td>
      <td>norte</td>
    </tr>
  </tbody>
</table>
<p>150 rows × 6 columns</p>
</div>




```python
df_sur["Total"] = df_sur["Precio_Base"] * df_sur["Cantidad"] * (1 - df_sur["Descuento_Aplicado"])
df_sur

mapping_sur = {
    "Ref_Venta" : "id_transaccion",
    'Fecha_Alta': 'fecha',
    "Total" : "total_venta",
    'Articulo': 'producto',
    "Cantidad":"cantidad"
}

df_sur = df_sur.rename(columns=mapping_sur)
df_sur['region'] = 'Sur'

columnas_finales = ["id_transaccion",'fecha', 'producto', 'cantidad', 'total_venta',"region"]
df_sur = df_sur[columnas_finales]
df_sur
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id_transaccion</th>
      <th>fecha</th>
      <th>producto</th>
      <th>cantidad</th>
      <th>total_venta</th>
      <th>region</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>S-5000</td>
      <td>2023-02-11 00:00:00</td>
      <td>Webcam HD</td>
      <td>9</td>
      <td>3060.864</td>
      <td>Sur</td>
    </tr>
    <tr>
      <th>1</th>
      <td>S-5001</td>
      <td>2023-02-03 12:00:00</td>
      <td>Teclado Mecánico</td>
      <td>8</td>
      <td>4796.800</td>
      <td>Sur</td>
    </tr>
    <tr>
      <th>2</th>
      <td>S-5002</td>
      <td>2023-04-06 07:00:00</td>
      <td>Mouse Ergonómico</td>
      <td>6</td>
      <td>5828.160</td>
      <td>Sur</td>
    </tr>
    <tr>
      <th>3</th>
      <td>S-5003</td>
      <td>2023-04-02 05:00:00</td>
      <td>Monitor 4K</td>
      <td>1</td>
      <td>719.694</td>
      <td>Sur</td>
    </tr>
    <tr>
      <th>4</th>
      <td>S-5004</td>
      <td>2023-06-17 12:00:00</td>
      <td>Mouse Ergonómico</td>
      <td>2</td>
      <td>1177.981</td>
      <td>Sur</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>155</th>
      <td>S-5075</td>
      <td>2023-05-17 22:00:00</td>
      <td>Monitor 4K</td>
      <td>2</td>
      <td>2070.018</td>
      <td>Sur</td>
    </tr>
    <tr>
      <th>156</th>
      <td>S-5076</td>
      <td>2023-01-29 13:00:00</td>
      <td>Webcam HD</td>
      <td>1</td>
      <td>786.708</td>
      <td>Sur</td>
    </tr>
    <tr>
      <th>157</th>
      <td>S-5077</td>
      <td>2023-06-09 11:00:00</td>
      <td>Mouse Ergonómico</td>
      <td>1</td>
      <td>145.920</td>
      <td>Sur</td>
    </tr>
    <tr>
      <th>158</th>
      <td>S-5078</td>
      <td>2023-02-07 13:00:00</td>
      <td>Monitor 4K</td>
      <td>2</td>
      <td>2304.480</td>
      <td>Sur</td>
    </tr>
    <tr>
      <th>159</th>
      <td>S-5079</td>
      <td>2023-05-01 11:00:00</td>
      <td>Docking Station</td>
      <td>7</td>
      <td>1649.844</td>
      <td>Sur</td>
    </tr>
  </tbody>
</table>
<p>160 rows × 6 columns</p>
</div>




```python
df_este = df_este.drop(columns=["Monto_IVA"])
df_este["region"] = "este"
df_este
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id_transaccion</th>
      <th>fecha</th>
      <th>ciudad</th>
      <th>producto</th>
      <th>cantidad</th>
      <th>total_venta</th>
      <th>region</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>E-8000</td>
      <td>2023-06-29 00:00:00</td>
      <td>Sevilla</td>
      <td>Monitor 4K</td>
      <td>1</td>
      <td>503</td>
      <td>este</td>
    </tr>
    <tr>
      <th>1</th>
      <td>E-8001</td>
      <td>2023-04-12 00:00:00</td>
      <td>Sevilla</td>
      <td>Webcam HD</td>
      <td>1</td>
      <td>1122</td>
      <td>este</td>
    </tr>
    <tr>
      <th>2</th>
      <td>E-8002</td>
      <td>2023-04-20 00:00:00</td>
      <td>Sevilla</td>
      <td>Webcam HD</td>
      <td>2</td>
      <td>994</td>
      <td>este</td>
    </tr>
    <tr>
      <th>3</th>
      <td>E-8003</td>
      <td>2023-04-14 00:00:00</td>
      <td>Madrid</td>
      <td>Webcam HD</td>
      <td>2</td>
      <td>1255</td>
      <td>este</td>
    </tr>
    <tr>
      <th>4</th>
      <td>E-8004</td>
      <td>2023-01-03 00:00:00</td>
      <td>Sevilla</td>
      <td>Monitor 4K</td>
      <td>2</td>
      <td>1458</td>
      <td>este</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>115</th>
      <td>E-8115</td>
      <td>2023-04-05 00:00:00</td>
      <td>Valencia</td>
      <td>Monitor 4K</td>
      <td>1</td>
      <td>829</td>
      <td>este</td>
    </tr>
    <tr>
      <th>116</th>
      <td>E-8116</td>
      <td>2023-04-23 00:00:00</td>
      <td>Valencia</td>
      <td>Laptop Gamer</td>
      <td>2</td>
      <td>858</td>
      <td>este</td>
    </tr>
    <tr>
      <th>117</th>
      <td>E-8117</td>
      <td>2023-06-03 00:00:00</td>
      <td>Sevilla</td>
      <td>Webcam HD</td>
      <td>2</td>
      <td>637</td>
      <td>este</td>
    </tr>
    <tr>
      <th>118</th>
      <td>E-8118</td>
      <td>2023-02-24 00:00:00</td>
      <td>Valencia</td>
      <td>Monitor 4K</td>
      <td>2</td>
      <td>502</td>
      <td>este</td>
    </tr>
    <tr>
      <th>119</th>
      <td>E-8119</td>
      <td>2023-01-08 00:00:00</td>
      <td>Madrid</td>
      <td>Mouse Ergonómico</td>
      <td>1</td>
      <td>306</td>
      <td>este</td>
    </tr>
  </tbody>
</table>
<p>120 rows × 7 columns</p>
</div>




```python
df_total = pd.concat([df_norte,df_este,df_sur],ignore_index=True)
```


```python
df_total.to_csv("ventas_consolidadas_2023.csv", sep=",", encoding="utf-8", index=False)
```
