## Dataset 1: Datos para la predicción del rendimiento en cultivos


```python
%cd PRO502/
```

    [Errno 2] No such file or directory: 'PRO502/'
    /workspace/PRO502


    /usr/local/lib/python3.10/site-packages/IPython/core/magics/osm.py:393: UserWarning: This is now an optional IPython functionality, using bookmarks requires you to install the `pickleshare` library.
      bkms = self.shell.db.get('bookmarks', {})



```python
from pyspark.sql import SparkSession
from pyspark.sql.types import StructType, StructField
from pyspark.sql.types import StringType, IntegerType, FloatType,BooleanType


spark = ( SparkSession.builder.appName("PRO502").master("spark://spark-master:7077").getOrCreate())

sc = spark.sparkContext


```


```python
main_schema = StructType([
    StructField("Crop",StringType(),True),
    StructField("Region",StringType(),True),
    StructField("Soil_Type",StringType(),True),
    StructField("Soil_pH",FloatType(),True),
    StructField("Rainfall_mm",FloatType(),True),
    StructField("Temperature_C",FloatType(),True),
    StructField("Humidity_pct",FloatType(),True),
    StructField("Fertilizer_Used_Kg",FloatType(),True),
    StructField("Irrigation",StringType(),True),
    StructField("Pesticides_Used_kg",FloatType(),True),
    StructField("Planting_Density",FloatType(),True),
    StructField("Previus_Crop",StringType(),True),
    StructField("Yield_ton_per_ha",FloatType(),True)
])

df_crop = (spark.read.format("csv")
      .option("header","true")
      .schema(main_schema)
      .load("crop_yield_dataset.csv"))


df_sel = df_crop.select("Crop","Region","Temperature_C","Rainfall_mm","Irrigation","Yield_ton_per_ha")


```


```python
df_renamed = (df_sel
    .withColumnRenamed("Temperature_C", "Temperatura")
    .withColumnRenamed("Rainfall_mm", "Lluvia")
    .withColumnRenamed("Yield_ton_per_ha", "Rendimiento")
)
df_renamed.show(5)
```

    +------+--------+-----------+------+----------+-----------+
    |  Crop|  Region|Temperatura|Lluvia|Irrigation|Rendimiento|
    +------+--------+-----------+------+----------+-----------+
    | Maize|Region_C|       19.7|1485.4|      Drip|     101.48|
    |Barley|Region_D|       29.1| 399.4| Sprinkler|     127.39|
    |  Rice|Region_C|       30.5| 980.9| Sprinkler|      68.99|
    | Maize|Region_D|       26.4|1054.3|      Drip|     169.06|
    | Maize|Region_D|       20.4| 744.6|      Drip|     118.71|
    +------+--------+-----------+------+----------+-----------+
    only showing top 5 rows
    



```python
from pyspark.sql.functions import col

df_filtered = df_renamed.filter(
    (col("Crop") == "Maize") & 
    (col("Temperatura") > 5)
)

df_filtered.show(5)
```

    +-----+--------+-----------+------+----------+-----------+
    | Crop|  Region|Temperatura|Lluvia|Irrigation|Rendimiento|
    +-----+--------+-----------+------+----------+-----------+
    |Maize|Region_C|       19.7|1485.4|      Drip|     101.48|
    |Maize|Region_D|       26.4|1054.3|      Drip|     169.06|
    |Maize|Region_D|       20.4| 744.6|      Drip|     118.71|
    |Maize|Region_C|       32.4| 846.1|      None|      162.2|
    |Maize|Region_C|       18.3| 209.5|     Flood|     116.72|
    +-----+--------+-----------+------+----------+-----------+
    only showing top 5 rows
    



```python
df_final = (df_sel
    .withColumnRenamed("Temperature_C", "Temperatura")
    .withColumnRenamed("Rainfall_mm", "Lluvia")
    .withColumnRenamed("Yield_ton_per_ha", "Rendimiento")
    .filter((col("Crop") == "Maize") & (col("Temperatura") > 25))
)

# Visualizamos el resultado final
df_final.show(5)
```

    +-----+--------+-----------+------+----------+-----------+
    | Crop|  Region|Temperatura|Lluvia|Irrigation|Rendimiento|
    +-----+--------+-----------+------+----------+-----------+
    |Maize|Region_D|       26.4|1054.3|      Drip|     169.06|
    |Maize|Region_C|       32.4| 846.1|      None|      162.2|
    |Maize|Region_A|       26.6| 362.5| Sprinkler|      95.23|
    |Maize|Region_C|       33.7|1193.3|      None|     110.57|
    |Maize|Region_C|       27.8| 695.2|     Flood|     143.84|
    +-----+--------+-----------+------+----------+-----------+
    only showing top 5 rows
    


## Dataset 2: Lugares famosos del mundo


```python
main_schema = StructType([
    StructField("Place_Name",StringType(),True),
    StructField("Country",StringType(),True),
    StructField("City",StringType(),True),
    StructField("Annual_Visitors_Millions",FloatType(),True),
    StructField("Type",StringType(),True),
    StructField("Unsesco_World_Heritage",StringType(),True),
    StructField("Year_Built",StringType(),True),
    StructField("Entry_Fee_USD",StringType(),True),
    StructField("Best_Visit_Month",StringType(),True),
    StructField("Region",StringType(),True),
    StructField("Tourism_Revenue_Million_USD",IntegerType(),True),
    StructField("Average_Visit_Duration_Hours",FloatType(),True),
    StructField("Famous_For",StringType(),True),
])

df = (spark.read.format("csv")
      .option("header","true")
      .schema(main_schema)
      .load("world_famous_places_2024.csv"))

df_base = df.select("Place_Name","Country","Unsesco_World_Heritage","Entry_Fee_USD","Annual_Visitors_Millions")
```


```python
df_es = (df_base
    .withColumnRenamed("Place_Name", "Lugar")
    .withColumnRenamed("Unsesco_World_Heritage", "Es_UNESCO")
    .withColumnRenamed("Entry_Fee_USD", "Precio_Entrada")
    .withColumnRenamed("Annual_Visitors_Millions", "Visitantes_Millones")
)
df_es.show()
```

    +--------------------+-------------+---------+--------------+-------------------+
    |               Lugar|      Country|Es_UNESCO|Precio_Entrada|Visitantes_Millones|
    +--------------------+-------------+---------+--------------+-------------------+
    |        Eiffel Tower|       France|       No|            35|                7.0|
    |        Times Square|United States|       No|             0|               50.0|
    |       Louvre Museum|       France|      Yes|            22|                8.7|
    | Great Wall of China|        China|      Yes|            10|               10.0|
    |           Taj Mahal|        India|      Yes|            15|                7.5|
    |           Colosseum|        Italy|      Yes|            18|               7.65|
    |   Statue of Liberty|United States|      Yes|            25|                4.3|
    |  Sydney Opera House|    Australia|      Yes|            49|                8.2|
    |        Machu Picchu|         Peru|      Yes|            70|                1.5|
    |      Forbidden City|        China|      Yes|             8|                9.0|
    |          Angkor Wat|     Cambodia|      Yes|            37|                2.6|
    |Notre-Dame Cathedral|       France|      Yes|             0|               13.0|
    |        Central Park|United States|       No|             0|               42.0|
    |     Las Vegas Strip|United States|       No|             0|               41.7|
    |Empire State Buil...|United States|       No|            44|                4.6|
    |  Golden Gate Bridge|United States|       No|             0|               15.0|
    |    Lincoln Memorial|United States|       No|             0|                8.5|
    |     Sagrada Familia|        Spain|      Yes|            26|                4.7|
    |Disneyland (Calif...|United States|       No|           104|               16.0|
    |Magic Kingdom (Or...|United States|       No|           109|               17.0|
    +--------------------+-------------+---------+--------------+-------------------+
    only showing top 20 rows
    



```python
df_fil = df_es.filter(
        (col("Es_UNESCO").contains("Yes")) & 
        (col("Precio_Entrada") <= 20)
    )

df_fil.show(5)
```

    +--------------------+-------+---------+--------------+-------------------+
    |               Lugar|Country|Es_UNESCO|Precio_Entrada|Visitantes_Millones|
    +--------------------+-------+---------+--------------+-------------------+
    | Great Wall of China|  China|      Yes|            10|               10.0|
    |           Taj Mahal|  India|      Yes|            15|                7.5|
    |           Colosseum|  Italy|      Yes|            18|               7.65|
    |      Forbidden City|  China|      Yes|             8|                9.0|
    |Notre-Dame Cathedral| France|      Yes|             0|               13.0|
    +--------------------+-------+---------+--------------+-------------------+
    only showing top 5 rows
    


## Dataset 3: Registro turístico de Castilla y León


```python
main_schema = StructType([
    StructField("establecimiento", StringType(), True),
    StructField("n_registro", StringType(), True),
    StructField("codigo", StringType(), True),
    StructField("tipo", StringType(), True),
    StructField("categoria", StringType(), True),
    StructField("especialidades", StringType(), True),
    StructField("clase", StringType(), True),
    StructField("nombre", StringType(), True),
    StructField("direccion", StringType(), True),
    StructField("c_postal", StringType(), True), 
    StructField("provincia", StringType(), True),
    StructField("municipio", StringType(), True),
    StructField("localidad", StringType(), True),
    StructField("nucleo", StringType(), True),
    StructField("telefono_1", StringType(), True),
    StructField("telefono_2", StringType(), True),
    StructField("telefono_3", StringType(), True),
    StructField("email", StringType(), True),
    StructField("web", StringType(), True),
    StructField("q_calidad", StringType(), True),
    StructField("posada_real", StringType(), True),
    StructField("plazas", IntegerType(), True),
    StructField("gps_longitud", FloatType(), True),
    StructField("gps_latitud", FloatType(), True),
    StructField("accesible_a_personas_con_discapacidad", StringType(), True),
    StructField("column_27", StringType(), True),
    StructField("posicion", StringType(), True)
])

df = (spark.read.format("csv")
      .option("header","true")
      .schema(main_schema)
      .option("sep", ";")
      .load("registro-de-turismo-de-castilla-y-leon.csv"))


df_contactos = df.select("nombre", "tipo", "provincia", "web", "email")

df_contactos.show(5)
```

    +--------------------+--------------------+---------+--------------------+--------------------+
    |              nombre|                tipo|provincia|                 web|               email|
    +--------------------+--------------------+---------+--------------------+--------------------+
    |BERNARDO MORO MEN...|Profesional de Tu...| Asturias|                NULL|bernardomoro@hotm...|
    |        LA SASTRERÍA|Casa Rural de Alq...|    Ávila|www.lasastreriade...|                NULL|
    |         LAS HAZANAS|Casa Rural de Alq...|    Ávila|                NULL|lashazanas@hotmai...|
    | LA CASITA DEL PAJAR|Casa Rural de Alq...|    Ávila|                NULL|lashazanas@hotmai...|
    |            MARACANA|                 Bar|    Ávila|                NULL|emo123anatoliev@g...|
    +--------------------+--------------------+---------+--------------------+--------------------+
    only showing top 5 rows
    



```python
df_limpio = (df_contactos
    .withColumnRenamed("nombre", "nombre_establecimiento")
    .withColumnRenamed("tipo", "categoria_actividad")
    .withColumnRenamed("web", "sitio_web")
    .withColumnRenamed("email", "correo_electronico")
)

df_limpio.show(5)
```

    +----------------------+--------------------+---------+--------------------+--------------------+
    |nombre_establecimiento| categoria_actividad|provincia|           sitio_web|  correo_electronico|
    +----------------------+--------------------+---------+--------------------+--------------------+
    |  BERNARDO MORO MEN...|Profesional de Tu...| Asturias|                NULL|bernardomoro@hotm...|
    |          LA SASTRERÍA|Casa Rural de Alq...|    Ávila|www.lasastreriade...|                NULL|
    |           LAS HAZANAS|Casa Rural de Alq...|    Ávila|                NULL|lashazanas@hotmai...|
    |   LA CASITA DEL PAJAR|Casa Rural de Alq...|    Ávila|                NULL|lashazanas@hotmai...|
    |              MARACANA|                 Bar|    Ávila|                NULL|emo123anatoliev@g...|
    +----------------------+--------------------+---------+--------------------+--------------------+
    only showing top 5 rows
    



```python
df_final = df_limpio.filter(
    (col("provincia") == "Burgos") & 
    (col("categoria_actividad").like("%Bodegas%")) & 
    (col("sitio_web").isNotNull()) & 
    (col("sitio_web") != "")
)


df_final.show()
```

    +----------------------+--------------------+---------+--------------------+--------------------+
    |nombre_establecimiento| categoria_actividad|provincia|           sitio_web|  correo_electronico|
    +----------------------+--------------------+---------+--------------------+--------------------+
    |        BODEGAS TARSUS|g - Bodegas y los...|   Burgos|  www.tarsusvino.com|                NULL|
    |  BODEGAS DOMINIO D...|g - Bodegas y los...|   Burgos|www.dominiodecair...|bodegas@dominiode...|
    |    TERRITORIO LUTHIER|g - Bodegas y los...|   Burgos|territorioluthier...|luthier@territori...|
    |    BODEGA COVARRUBIAS|g - Bodegas y los...|   Burgos| http://valdable.com|   info@valdable.com|
    |  BODEGAS PASCUAL, ...|g - Bodegas y los...|   Burgos|222.bodegaspascua...|export@bodegaspas...|
    |   BODEGAS VINUM VITAE|g - Bodegas y los...|   Burgos|      www.avañate.es|vinum.vitae.bodeg...|
    |  VIÑEDOS Y BODEGAS...|g - Bodegas y los...|   Burgos|     www.ferratus.es|administracion@fe...|
    |  BODEGAS Y VIÑEDOS...|g - Bodegas y los...|   Burgos|     www.pradorey.es|   info@pradorey.com|
    |       BODEGAS ARROCAL|g - Bodegas y los...|   Burgos|     www.arrocal.com|  blanca@arrocal.com|
    |           VIÑA ARNÁIZ|g - Bodegas y los...|   Burgos|  www.vinaarnaiz.com|   enoturismo@jgc.es|
    |    BODEGAS MONTE AMÁN|g - Bodegas y los...|   Burgos|   www.monteaman.com|bodegas@monteaman...|
    |  BODEGAS PALACIO D...|g - Bodegas y los...|   Burgos|www.palaciodelerm...|info@palaciodeler...|
    |         ALONSO ANGULO|g - Bodegas y los...|   Burgos|www.alonsoangulo.com|info@alonsoangulo...|
    |  VIÑA MAMBRILLA, S.L.|g - Bodegas y los...|   Burgos|   www.mambrilla.com| bodegamambrilla.com|
    |  BODEGAS TRASLASCU...|g - Bodegas y los...|   Burgos|www.bodegastrasla...|administracion@bo...|
    |  BODEGAS RODERO, S.L.|g - Bodegas y los...|   Burgos|www.bodegasrodero...|rodero@bodegasrod...|
    |  BODEGAS HERMANOS ...|g - Bodegas y los...|   Burgos|www.perezpascuas.com|viñapedrosa@perez...|
    |    BOSQUE DE MATASNOS|g - Bodegas y los...|   Burgos|https://bosquedem...|administracion@bo...|
    |  BODEGAS PRADO DE ...|g - Bodegas y los...|   Burgos|www.pradodeolmedo...|pradodeolmedo@pra...|
    |  VISITAS ENOTURÍST...|g - Bodegas y los...|   Burgos|www.lopezcristoba...|bodega@lopezcrist...|
    +----------------------+--------------------+---------+--------------------+--------------------+
    only showing top 20 rows
    

